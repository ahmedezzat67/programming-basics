<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اختبار الدرس الثاني - المتغيرات والشروط</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        
        /* الأنماط (Styles) الأساسية كما هي */
        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #f9f9f9, #e0f7fa);
            color: #222;
            text-align: center;
            padding: 20px;
        }

        h1 {
            color: #00796b;
            font-size: 2em;
        }
        h2 {
            color: #004d40;
            font-size: 1.5em;
            margin-top: 30px;
            border-bottom: 2px solid #e0f7fa;
            padding-bottom: 10px;
        }

        .quiz-container {
            max-width: 800px;
            margin: auto;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            text-align: right;
        }

        .question {
            margin: 20px 0;
            font-weight: bold;
            color: #004d40;
            white-space: pre-wrap;
            text-align: right;
        }
        
        .code-snippet {
            display: block;
            background-color: #f1f8e9;
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            direction: ltr;
            text-align: left;
            overflow-x: auto;
        }

        .option {
            background-color: #f1f8e9;
            border: 2px solid #009688;
            border-radius: 10px;
            padding: 10px;
            margin: 8px 0;
            cursor: pointer;
            transition: 0.3s;
        }

        .option:hover {
            background-color: #e0f2f1;
            transform: scale(1.03);
        }
        /* أنماط للإجابة الصحيحة والخاطئة */
        .option.correct {
            background-color: #a5d6a7 !important; /* أخضر فاتح */
        }
        .option.wrong {
            background-color: #ef9a9a !important; /* أحمر فاتح */
        }


        .feedback {
            margin-top: 8px;
            font-size: 15px;
            font-weight: bold;
            color: #004d40;
            min-height: 20px; /* لضمان عدم اهتزاز الصفحة */
        }

        .btn {
            background: linear-gradient(90deg, #009688, #26a69a);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .btn:hover {
            transform: scale(1.05);
            background: linear-gradient(90deg, #00796b, #004d40);
        }

        .result {
            font-size: 18px;
            margin-top: 20px;
            font-weight: bold;
            text-align: center;
        }

        .footer {
            margin-top: 30px;
            font-size: 14px;
            color: #555;
            text-align: center;
        }

        /* أنماط المشروع التطبيقي */
        .project-section {
            border: 2px solid #009688;
            padding: 20px;
            border-radius: 15px;
            background-color: #f7fff7;
            margin-top: 20px;
        }
        .project-explanation {
            line-height: 1.7;
            font-weight: 600;
        }
        .project-output {
            margin-top: 10px;
            background:#fff;
            padding:12px;
            border-radius:8px;
            font-family:monospace;
            direction:ltr;
            text-align:left;
            white-space:pre-wrap;
            min-height:50px;
            color:#004d40;
            font-weight:700;
            border: 1px solid #ccc;
        }
        .project-output.error {
            background:#fff0f0;
            color:#a00;
            border-color: #a00;
        }
        .project-output.success {
            background: #e6ffe6;
            color: #0a0;
            border-color: #0a0;
        }
        .editor {
            width:100%;
            min-height:150px;
            font-family:monospace;
            font-size:15px;
            direction:ltr;
            text-align:left;
            border-radius:10px;
            padding:12px;
            border:2px solid #d6eae6;
            background:#fff;
            resize:vertical;
        }
    </style>
</head>
<body>

    <h1>📘 اختبار الدرس الثاني - المتغيرات والجمل الشرطية</h1>

    <div class="quiz-container" id="quiz">
        <div id="questions"></div>
        
        <div style="text-align:center; margin-top: 20px;">
            <button class="btn" onclick="submitQuiz()">عرض مجموع النقاط</button>
            <button class="btn" onclick="showCorrectAnswers()">اعرض الإجابات الصحيحة</button>
        </div>
        <div id="result" class="result"></div>
        
        <h2>🚀 مشروع تطبيقي: اختبار النجاح والرسوب</h2>
        <div class="project-section">
            <p class="project-explanation">
                <strong>المهمة:</strong> اكتب كود JavaScript يحقق الشروط التالية:
                <ol style="text-align: right;">
                    <li>عرّف متغيّر اسمه <code>studentScore</code> وأسند له قيمة 75.</li>
                    <li>استخدم جملة <code>if/else</code>:</li>
                    <li>إذا كانت قيمة <code>studentScore</code> **أكبر من أو تساوي 60**، اطبع في الـ Console (باستخدام <code>console.log</code>): <code>"مبروك، الطالب ناجح!"</code></li>
                    <li>وإلا (في حالة الرسوب)، اطبع: <code>"للاسف، الطالب راسب. محاولة اخرى!"</code></li>
                </ol>
            </p>
            <label>اكتب الكود بتاعك هنا:</label>
            <textarea id="project_editor" class="editor">let studentScore = 75;
// اكتب الكود الشرطي هنا</textarea>
            <div style="text-align:center;">
                <button class="btn" onclick="runProjectTest()">▶ تشغيل الكود واختبار النتيجة</button>
            </div>
            <div id="project_output" class="project-output">الناتج سيظهر هنا...</div>
        </div>
        
        <br>
        <div style="text-align:center;">
            <button class="btn" onclick="location.href='lesson2.html'">🔙 رجوع للدرس</button> 
            <button class="btn" onclick="location.href='index.html'">🏠 الصفحة الرئيسية</button>
            <button class="btn" onclick="location.href='lesson3.html'">➡️ الدرس الثالث</button>
        </div>
    </div>

    <div class="footer">
        تم التصميم بواسطة <strong>Ahmed Ezzat</strong> ❤️
    </div>

    <script>
        const quizData = [
            // نفس الـ 20 سؤال
            { 
                question: "إيه النتيجة النهائية للمتغير 'score'؟\n<span class='code-snippet'>let score = 50;\nscore = 100;\nscore += 20;</span>", 
                options: ["50", "100", "120", "150"], 
                answer: 2, 
                explanation: "يبدأ بـ 50، ثم يتم إسناد 100، ثم يضاف إليه 20، ليصبح 120." 
            },
            { 
                question: "ماذا يعني التعبير 'apple = apple + 10;'؟", 
                options: ["أن القيمة الجديدة لـ apple هي 10", "أن قيمة apple تزيد بمقدار 10", "أن قيمة apple تنقص بمقدار 10", "أنه خطأ في الكود"], 
                answer: 1, 
                explanation: "هذا التعبير يزيد القيمة الحالية للمتغير apple بمقدار 10." 
            },
            { 
                question: "ما هو الاختصار الصحيح لـ 'count = count - 1;'؟", 
                options: ["count -= 1;", "count = -1;", "count --;", "count //= 1;"], 
                answer: 0, 
                explanation: "الاختصار القياسي هو <code>-=</code>، بالرغم من أن <code>count--</code> يعمل أيضاً." 
            },
            { 
                question: "لو كان <span class='code-snippet'>let money = 200;</span>. بعد سطر <span class='code-snippet'>money = 50;</span>، كم تكون قيمة money؟", 
                options: ["200", "50", "250", "0"], 
                answer: 1, 
                explanation: "عملية الإسناد ( = ) تلغي القيمة القديمة وتضع القيمة الجديدة 50." 
            },
            { 
                question: "ماذا سيتم طباعته؟\n<span class='code-snippet'>let x = 10;\nx++;\nconsole.log(x);</span>", 
                options: ["10", "11", "9", "خطأ"], 
                answer: 1, 
                explanation: "العامل <code>++</code> يزيد المتغير بمقدار 1 (10 + 1 = 11)." 
            },
            { 
                question: "لأي غرض تستخدم جملة <code>if</code>؟", 
                options: ["لتخزين قيمة", "لتكرار كود", "لاتخاذ قرار بناءً على شرط", "لتشغيل الصفحة"], 
                answer: 2, 
                explanation: "تستخدم <code>if</code> للتحكم في سير البرنامج من خلال تنفيذ كود معين إذا تحقق شرط." 
            },
            { 
                question: "ماذا يعني الرمز <code>===</code>؟", 
                options: ["مقارنة القيمة فقط", "إسناد قيمة", "مقارنة القيمة والنوع معاً", "مقارنة النصوص فقط"], 
                answer: 2, 
                explanation: "<code>===</code> يقارن القيمة ونوع البيانات، وهو الأفضل في الغالب." 
            },
            { 
                question: "ماذا سيتم طباعته؟\n<span class='code-snippet'>console.log(10 == '10');</span>", 
                options: ["true", "false", "خطأ", "undefined"], 
                answer: 0, 
                explanation: "<code>==</code> لا يقارن النوع، لذلك يعتبر الرقم 10 مساوٍ للنص '10'." 
            },
            { 
                question: "ماذا سيتم طباعته؟\n<span class='code-snippet'>console.log(10 === '10');</span>", 
                options: ["true", "false", "خطأ", "undefined"], 
                answer: 1, 
                explanation: "<code>===</code> يقارن النوع (رقم ونوع نص)، وهما غير متساويين." 
            },
            { 
                question: "ماذا يعني الرمز <code>!</code> قبل متغير (مثل <code>!isDone</code>)؟", 
                options: ["يعكس القيمة المنطقية (Not)", "يعني أن المتغير فارغ", "يضرب القيمة في -1", "يوقف البرنامج"], 
                answer: 0, 
                explanation: "<code>!</code> هو عامل النفي (Not)، ويعكس قيمة <code>true</code> إلى <code>false</code> والعكس." 
            },
            { 
                question: "أي من التالي **ليس** عبارة عن شرط صحيح؟", 
                options: ["score > 90", "isLoggedIn === true", "if (x < 5)", "age <= 18"], 
                answer: 2, 
                explanation: "<code>if (x < 5)</code> هي جملة شرطية كاملة وليست مجرد عبارة شرطية (expression)." 
            },
            { 
                question: "ماذا سيتم طباعته؟\n<span class='code-snippet'>let day = 'Sun';\nif (day === 'Mon') {\n  console.log('Work');\n} else {\n  console.log('Rest');\n}</span>", 
                options: ["Work", "Rest", "خطأ", "لا شيء"], 
                answer: 1, 
                explanation: "المتغير <code>day</code> هو 'Sun' وليس 'Mon'، لذا سيتم تنفيذ كود <code>else</code>." 
            },
            { 
                question: "لتحديد متغير ثابت (لا تتغير قيمته)، نستخدم:", 
                options: ["let", "var", "const", "final"], 
                answer: 2, 
                explanation: "<code>const</code> تستخدم لتعريف الثوابت التي يجب أن تظل قيمتها ثابتة." 
            },
            { 
                question: "لو كانت <span class='code-snippet'>let result = 1;\nresult *= 5;</span>. كم تكون قيمة result؟", 
                options: ["1", "5", "10", "خطأ"], 
                answer: 1, 
                explanation: "<code>*=</code> هو اختصار للضرب والإسناد. (1 * 5 = 5)." 
            },
            { 
                question: "ماذا سيتم طباعته؟\n<span class='code-snippet'>let temp = 25;\nif (temp > 30) {\n  console.log('Hot');\n}\nconsole.log('Done');</span>", 
                options: ["Hot", "Done", "Hot\nDone", "خطأ"], 
                answer: 1, 
                explanation: "الشرط (25 > 30) غير صحيح، فلن يتم طباعة 'Hot'. سيتم طباعة 'Done' فقط لأنه خارج الـ <code>if</code>." 
            },
            { 
                question: "أي رمز يستخدم لـ 'أصغر من أو يساوي'؟", 
                options: ["<", ">", "<=", ">="], 
                answer: 2, 
                explanation: "<code><=</code> يعني أصغر من أو يساوي." 
            },
            { 
                question: "لو كانت قيمة 'isLogged' هي <code>false</code>، ما قيمة <code>!isLogged</code>؟", 
                options: ["true", "false", "undefined", "0"], 
                answer: 0, 
                explanation: "<code>!</code> يعكس القيمة المنطقية، فـ <code>!false</code> تكون <code>true</code>." 
            },
            { 
                question: "ماذا سيتم طباعته؟\n<span class='code-snippet'>let item = 10;\nitem /= 2;\nconsole.log(item);</span>", 
                options: ["20", "5", "10", "خطأ"], 
                answer: 1, 
                explanation: "<code>/=</code> هو اختصار للقسمة والإسناد. (10 / 2 = 5)." 
            },
            { 
                question: "لو كتبنا <span class='code-snippet'>let val = 10;</span>، وبعدها <span class='code-snippet'>val = 'Hello';</span>، ماذا حدث؟", 
                options: ["حدث خطأ", "تم تحديث القيمة والنوع", "تم تحديث النوع فقط", "تم تحديث القيمة فقط"], 
                answer: 1, 
                explanation: "تم تغيير القيمة من 10 إلى 'Hello' وتغير النوع من رقم (number) إلى نص (string)." 
            },
            { 
                question: "ماذا سيتم طباعته؟\n<span class='code-snippet'>let num = 5;\nif (num > 5) {\n  console.log(1);\n} else if (num === 5) {\n  console.log(2);\n} else {\n  console.log(3);\n}</span>", 
                options: ["1", "2", "3", "لا شيء"], 
                answer: 1, 
                explanation: "الشرط الأول (5 > 5) خاطئ. الشرط الثاني (5 === 5) صحيح، فيتم طباعة 2." 
            }
        ];

        const questionsDiv = document.getElementById("questions");
        let selectedAnswers = new Array(quizData.length).fill(null);

        quizData.forEach((q, i) => {
            const div = document.createElement("div");
            div.classList.add("question-block");
            div.id = `q-${i}`; // إضافة ID لكل سؤال
            
            div.innerHTML = `
                <p class="question">${i + 1}. ${q.question}</p>
                ${q.options.map((opt, index) => `
                    <div class="option" data-q-index="${i}" data-opt-index="${index}" onclick="selectOption(${i}, ${index}, this)">${opt}</div>
                `).join('')}
                <div id="feedback-${i}" class="feedback"></div>
            `;
            questionsDiv.appendChild(div);
        });

        /* ===========================
          تحديث وظيفة selectOption
          (لتوفير التغذية الراجعة الفورية)
          =========================== */
        function selectOption(qIndex, optIndex, el) {
            const questionBlock = el.parentNode;
            const options = questionBlock.querySelectorAll(".option");
            const feedback = questionBlock.querySelector(`#feedback-${qIndex}`);
            const q = quizData[qIndex];

            // 1. إعادة تعيين التلوين
            options.forEach(opt => {
                opt.classList.remove('correct', 'wrong');
                opt.style.backgroundColor = "#f1f8e9";
            });

            selectedAnswers[qIndex] = optIndex;
            
            // 2. إظهار الإجابة الفورية وتلوينها
            if (optIndex === q.answer) {
                el.classList.add('correct');
                feedback.innerHTML = `✅ **صحيح!** ${q.explanation}`;
                feedback.style.color = "#2e7d32";
            } else {
                el.classList.add('wrong');
                feedback.innerHTML = `❌ **خطأ!** الإجابة الصحيحة: <b>${q.options[q.answer]}</b> - ${q.explanation}`;
                feedback.style.color = "#c62828";
            }
        }

        /* ===========================
          وظيفة عرض النتيجة الكلية
          (بدون إظهار التفسير مرة أخرى)
          =========================== */
        function submitQuiz() {
            let score = 0;
            let total = quizData.length;
            let unanswered = 0;
            
            quizData.forEach((q, i) => {
                if (selectedAnswers[i] === null) {
                    unanswered++;
                } else if (selectedAnswers[i] === q.answer) {
                    score++;
                }
            });

            const resultDiv = document.getElementById("result");
            
            if (unanswered > 0) {
                resultDiv.innerHTML = `🚫 لم تجب على ${unanswered} سؤال. `;
            } else {
                resultDiv.innerHTML = "";
            }

            if (score === total) {
                resultDiv.innerHTML += `🎉 ممتاز يا مبرمج المستقبل! جبت <b>${score}</b> من <b>${total}</b> ✅`;
            } else if (score >= total * 0.7) {
                resultDiv.innerHTML += `👏 نتيجتك رائعة! جبت <b>${score}</b> من <b>${total}</b>، شوية مراجعة بسيطة. 💪`;
            } else if (score >= total / 2) {
                resultDiv.innerHTML += `🙂 نتيجتك جيدة! جبت <b>${score}</b> من <b>${total}</b>، راجع الأجزاء اللي أخطأت فيها.`;
            } else {
                resultDiv.innerHTML += `🤔 محتاج مراجعة بسيطة، جبت <b>${score}</b> من <b>${total}</b>. لا تيأس، كرر المحاولة!`;
            }
        }

        function showCorrectAnswers() {
            quizData.forEach((q, i) => {
                const questionBlock = document.getElementById(`q-${i}`);
                const options = questionBlock.querySelectorAll(".option"); 
                const feedback = questionBlock.querySelector(`#feedback-${i}`);

                // مسح التلوين السابق وتلوين الصحيح فقط
                options.forEach(opt => {
                    opt.classList.remove('correct', 'wrong');
                    opt.style.backgroundColor = "#f1f8e9";
                });

                options[q.answer].classList.add('correct');
                feedback.innerHTML = `✅ الإجابة الصحيحة: <b>${q.options[q.answer]}</b> - ${q.explanation}`;
                feedback.style.color = "#2e7d32";
            });
            document.getElementById("result").innerHTML = "تم تظليل الإجابات الصحيحة. راجع الشرح في كل سؤال.";
        }


        /* ===========================
          وظيفة اختبار المشروع التطبيقي
          =========================== */
        function executeAndCapture(codeStr){
            const logs = [];
            const origConsole = window.console.log; 

            // إعادة توجيه console.log لملء المصفوفة logs
            window.console.log = function(...args){
                const line = args.map(a=>{
                    if (typeof a === 'object' && a !== null) {
                        try { return JSON.stringify(a); } catch(e){ return String(a); } 
                    }
                    return String(a);
                }).join(' ');
                logs.push(line);
                try { origConsole.apply(window.console, args); } catch(e){}
            };

            let error = null;
            try {
                // تنفيذ الكود في بيئة معزولة
                const codeToExecute = `'use strict';\n${codeStr}`;
                const fn = new Function(codeToExecute);
                fn();
            } catch (err) {
                let msg = err && err.message ? err.message : String(err);
                msg = msg.replace(/\n/g,' ').replace(/\s+/g,' ').trim();
                error = { msg };
            } finally {
                // إعادة console.log لوظيفته الأصلية
                window.console.log = origConsole;
            }
            return { logs, error };
        }

        function runProjectTest(){
            const editor = document.getElementById('project_editor');
            const outputEl = document.getElementById('project_output');
            const code = editor.value || '';
            const cleanedCode = code.replace(/\/\*[\s\S]*?\*\//g, '').replace(/\/\/.*$/gm, '').trim();

            outputEl.classList.remove('success', 'error');
            outputEl.textContent = '... جاري التنفيذ والتحقق ...';

            if (!cleanedCode) {
                outputEl.classList.add('error');
                outputEl.textContent = '⚠️ اكتب الكود أولاً.';
                return;
            }

            // 1. التحقق من وجود المتغيرات والجمل الشرطية المطلوبة
            if (!/let\s+studentScore\s*=\s*75/i.test(cleanedCode)) {
                outputEl.classList.add('error');
                outputEl.textContent = '❌ خطأ: تأكد من تعريف المتغير let studentScore = 75; بشكل صحيح.';
                return;
            }
            if (!/if\s*\([^)]*>= 60[^)]*\)/i.test(cleanedCode)) {
                outputEl.classList.add('error');
                outputEl.textContent = '❌ خطأ: تأكد من استخدام الشرط (>= 60) في جملة if.';
                return;
            }

            // 2. تنفيذ الكود واختبار الناتج
            const studentRes = executeAndCapture(code);

            if (studentRes.error) {
                outputEl.classList.add('error');
                outputEl.textContent = `❌ خطأ في الكود: ${studentRes.error.msg}`;
                return;
            }

            const studentOutput = (studentRes.logs || []).join('\n').trim();
            const expectedSuccess = "مبروك، الطالب ناجح!";
            const expectedFail = "للاسف، الطالب راسب. محاولة اخرى!";

            if (studentOutput === expectedSuccess) {
                // التحقق من صحة الكود باستخدام قيمة راسبة أيضاً
                let failCode = code.replace(/let\s+studentScore\s*=\s*75/i, 'let studentScore = 50;');
                const failRes = executeAndCapture(failCode);
                const failOutput = (failRes.logs || []).join('\n').trim();
                
                if (failOutput === expectedFail) {
                    outputEl.classList.add('success');
                    outputEl.textContent = `✅ ممتاز! الكود يعمل بشكل صحيح لجميع الحالات (الناجح والراسب). \nالناتج: ${studentOutput}`;
                } else {
                    outputEl.classList.add('error');
                    outputEl.textContent = `⚠️ الكود ينجح لـ 75، لكن لم يعمل بالشكل الصحيح مع قيمة 50. تأكد من وجود else وطباعة رسالة الرسوب. \nالناتج الحالي: ${studentOutput}`;
                }

            } else {
                outputEl.classList.add('error');
                if (studentOutput.includes(expectedFail)) {
                    outputEl.textContent = `❌ الناتج خطأ! الكود طبع رسالة الرسوب بدلاً من النجاح. تأكد من الشرط (>= 60) والرسائل المطبوعة. \nالناتج: ${studentOutput}`;
                } else {
                    outputEl.textContent = `❌ الناتج خطأ! تأكد من أن الكود يطبع: "مبروك، الطالب ناجح!" عند 75.\nالناتج اللي طلع: ${studentOutput || '(لم يتم طباعة شيء)'}`;
                }
            }
        }
    </script>

</body>
</html>